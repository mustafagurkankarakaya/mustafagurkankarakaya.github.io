---
title: "WannaCry Malware Analizi"
date: 2025-02-25 00:00:00 +0800 
categories: [Malware Analysis]
tags: [Malware Analysis]     # TAG names should always be lowercase
---

## WannaCry Malware Analizi

![resim]({{ site.url }}{{ site.baseurl }}/assets/img/posts/Wanna-1.webp)


WannaCry, Mayıs 2017'de Windows'un SMBv1 protokolündeki EternalBlue güvenlik açığını kullanarak yayılan ve dosyaları şifreleyerek fidye talep eden bir fidye yazılımıdır (ransomware). 150'den fazla ülkeyi etkileyen saldırı, NHS, FedEx ve Renault gibi büyük kuruluşlara zarar vermiştir. Şifrelenen dosyaları açmak için Bitcoin ile ödeme talep eden yazılım, İngiliz güvenlik araştırmacısı Marcus Hutchins tarafından keşfedilen bir kill switch sayesinde durdurulmuştur. Microsoft, saldırıya karşı MS17-010 güvenlik yamasını yayımlayarak açığı kapatmıştır.

**Özet**

WannaCry, art arda çalıştırılan iki bileşenden oluşur ve sistemdeki dosyaları şifreleyerek SMB ve internet üzerinden aynı ağdaki diğer cihazlara yayılır.

Başlangıç dosyası çalıştırıldığında, yönetici ayrıcalıklarını kontrol eder ve belirli bir URL'ye bağlanmaya çalışır. Eğer yönetici erişimi sağlanmışsa ve URL'ye ulaşılamıyorsa, zararlı yazılım sistemdeki tüm dosyaları şifrelemeye devam eder.

Enfeksiyon belirtileri arasında, "Ooops, your important files are encrypted" mesajını içeren bir duvar kağıdı ve aşağıdaki dosyalar bulunmaktadır:

C:\Windows\tasksche.exe
C:\Users%USER%\Desktop@Please_Read_Me@.txt
C:\Users%USER%\Desktop@WanaDecryptor@.exe
C:\Users%USER%\Desktop@WanaDecryptor@.bmp

![resim]({{ site.url }}{{ site.baseurl }}/assets/img/posts/Wanna-2.png)
![resim]({{ site.url }}{{ site.baseurl }}/assets/img/posts/Wanna-3.png)


İlk aşama bileşeni çalıştırıldığında kontrol edilen iki ana kill-switch bulunur:

1.Belirtilen alan adına erişilip erişilemediğini doğrulamak:

“iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com”

2.Yönetici ayrıcalıklarıyla çalıştırılıp çalıştırılmadığını doğrulamak:

Eğer ilk kontrol başarılı olursa, process hiçbir işlem gerçekleştirmeden kapanır. Ancak, bu kontrol başarısız olursa, process “C:\Windows” dizini altında “tasksche.exe” adlı bir dosya oluşturmaya çalışır. Yönetici ayrıcalıkları olmadan çalıştırıldığında, bu işlem başarısız olur. Eğer dosya yönetici ayrıcalıklarıyla çalıştırılırsa ve ilk kontrol başarılı olursa, yine hiçbir işlem gerçekleştirilmez. Ancak, ilk kontrol başarısız olursa, zararlı yazılım beklenen şekilde çalışmaya devam eder.

ANALİZ

IDA pro aracı kullanarak malware'e ait stringleri kontrol edelim.

![resim]({{ site.url }}{{ site.baseurl }}/assets/img/posts/Wanna-4.png)


hxxp[:]//www[.]iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea[.]com adresi yüksek olasılıkla WannaCry zararlısının kullandığı komuta kontrol sunucusuna ait. %s paramatresinin olması ise dynamic olarak oluşacak dosya isimlerine işaret etmektedir.

![resim]({{ site.url }}{{ site.baseurl }}/assets/img/posts/Wanna-5.png)
